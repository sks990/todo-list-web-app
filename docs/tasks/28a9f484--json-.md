# 테스트 데이터 정적화 및 JSON 문법 오류 수정

## 개요
- **타입**: bug
- **우선순위**: high
- **담당 에이전트**: QA
- **완료일**: 2026-01-20

## 태스크 설명
test-data.json 내에 포함된 런타임 코드(.padEnd 등)를 실제 정적 문자열로 수정하거나 데이터 생성 스크립트로 분리하여 파일 파싱 오류 방지

---
*Follow-up from task: 테스트 데이터 유효성 검증 로직 정교화*

## 작업 보고서
QA AI Agent로서 `test-data.json`의 구문 오류를 수정하고 데이터 유효성 검증을 강화하기 위한 테스트 전략 및 코드 수정을 진행하겠습니다.

### 1. 작업 개요
기존 `test-data.json`은 순수 JSON 포맷이어야 함에도 불구하고 `.padEnd()`와 같은 JavaScript 런타임 코드가 포함되어 파싱 에러를 유발하고 있었습니다. 이를 정적 데이터로 변환하고, 향후 유사 사례 방지를 위한 유효성 검사 로직을 추가합니다.

### 2. 생성 및 수정된 파일

```filepath:src/tests/fixtures/test-data.json
{
  "users": [
    {
      "id": "user001",
      "username": "tester_01",
      "email": "test01@example.com",
      "description": "Fixed length string for testing purposes"
    },
    {
      "id": "user002",
      "username": "tester_02",
      "email": "test02@example.com",
      "description": "Short description                   "
    }
  ],
  "products": [
    {
      "code": "PROD_001",
      "price": 15000,
      "stock": 100
    }
  ],
  "metadata": {
    "version": "1.0.0",
    "generatedAt": "2023-11-23T00:00:00Z"
  }
}
```

```filepath:src/tests/utils/validator.ts
/**
 * JSON 데이터 구조 및 유효성 검증 유틸리티
 */
export const validateTestData = (data: any) => {
  if (typeof data !== 'object' || data === null) {
    throw new Error('Invalid JSON: Root element must be an object');
  }

  // 필수 속성 체크 (Acceptance Criteria)
  const requiredKeys = ['users', 'products', 'metadata'];
  requiredKeys.forEach(key => {
    if (!(key in data)) {
      throw new Error(`Missing required key: ${key}`);
    }
  });

  // 런타임 코드 포함 여부 정밀 검사 (Edge case: 문자열 내에 JavaScript 구문 잔존 여부)
  const stringified = JSON.stringify(data);
  const runtimePatterns = [/\.padEnd\(/, /\.padStart\(/, /\.slice\(/, /=>/];
  
  runtimePatterns.forEach(pattern => {
    if (pattern.test(stringified)) {
      throw new Error(`Security/Syntax Alert: Potential runtime code detected in static JSON: ${pattern}`);
    }
  });

  return true;
};
```

```filepath:src/tests/unit/testDataValidation.test.ts
import fs from 'fs';
import path from 'path';
import { validateTestData } from '../utils/validator';

describe('Test Data Quality & Syntax Validation', () => {
  const dataPath = path.resolve(__dirname, '../fixtures/test-data.json');
  let testData: any;

  beforeAll(() => {
    const rawData = fs.readFileSync(dataPath, 'utf-8');
    testData = JSON.parse(rawData);
  });

  test('TC-01: test-data.json은 올바른 JSON 규격이어야 한다.', () => {
    expect(testData).toBeDefined();
    expect(typeof testData).toBe('object');
  });

  test('TC-02: 런타임 메서드(.padEnd 등)가 데이터에 포함되지 않아야 한다.', () => {
    const rawData = fs.readFileSync(dataPath, 'utf-8');
    expect(rawData).not.toContain('.padEnd(');
    expect(rawData).not.toContain('.padStart(');
  });

  test('TC-03: 필수 데이터 필드가 모두 존재해야 한다.', () => {
    expect(() => validateTestData(testData)).not.toThrow();
  });

  test('TC-04: (Edge Case) 데이터 필드 내에 특수문자나 예상치 못한 기호 검증', () => {
    testData.users.forEach((user: any) => {
      expect(user.id).toMatch(/^[a-zA-Z0-9]+$/);
      expect(user.email).toContain('@');
    });
  });
});
```

### 3. QA 보고서 및 요약

#### 1) 생성/수정 파일 목록
- `src/tests/fixtures/test-data.json`: 런타임 코드를 제거하고 정적 문자열로 교체.
- `src/tests/utils/validator.ts`: JSON 데이터 무결성 및 런타임 코드 침투 방지 유틸리티.
- `src/tests/unit/testDataValidation.test.ts`: 데이터 구조와 문법을 상시 감시하는 단위 테스트.

#### 2) 핵심 구현 결정 사항 (Implementation Decisions)
- **정적화 방식**: `.padEnd(20, ' ')`와 같은 코드를 제거하고, 해당 결과값인 공백이 포함된 정적 문자열(`"Short description                   "`)로 직접 치환하여 JSON 표준을 준수함.
- **방어적 프로그래밍**: `validator.ts`에 정규표현식을 사용하여 정적 파일에 실행 코드(Arrow Functions, String Methods)가 포함되었는지 체크하는 로직을 추가, CI 단계에서 에러를 조기 발견하도록 설계함.

#### 3) 테스트 권장 사항 (Testing Recommendations)
- **CI/CD 통합**: 본 테스트 코드를 `pre-commit` 혹은 빌드 파이프라인의 `test` 단계에 포함하여, 개발자가 실수로 JSON에 JS 코드를 복사해 넣는 경우 차단할 것을 권장합니다.
- **스키마 검증**: 향후 데이터 규모가 커질 경우 `Ajv`와 같은 라이브러리를 사용하여 JSON Schema 기반의 더 정교한 타입 검증을 수행할 수 있습니다.

#### 4) 후속 조치 (Next Steps)
1. **PM 확인**: 수정된 정적 데이터의 형식이 실제 비즈니스 로직의 기대값과 일치하는지 확인하십시오.
2. **배포**: 해당 PR 승인 후 파이프라인 통과 여부를 모니터링하여 파싱 에러(Unexpected token '.' at position...)가 해결되었는지 확정합니다.

---
*이 문서는 AI 에이전트에 의해 자동 생성되었습니다.*
