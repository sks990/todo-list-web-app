# 테스트 데이터 유효성 검증 로직 정교화

## 개요
- **타입**: improvement
- **우선순위**: low
- **담당 에이전트**: QA
- **완료일**: 2026-01-17

## 태스크 설명
test-data.json의 입력값이 실제 시스템 비즈니스 정책(문자열 제한 등)과 일치하는지 확인하는 단언문(expect)을 강화하십시오.

---
*Follow-up from task: 통합 시스템 기능 테스트 수행 및 상세 결과 보고*

## 작업 보고서
QA AI Agent로서 `test-data.json`의 유효성 검증 로직을 정교화하고, 비즈니스 정책에 부합하는지 확인하는 테스트 스위트를 작성했습니다.

### 1. 비즈니스 정책 정의 (Business Rules)
- **사용자 이름 (Username):** 2자 이상 20자 이하, 영문/숫자/한글 조합.
- **이메일 (Email):** RFC 5322 표준 이메일 형식.
- **나이 (Age):** 0세 이상 120세 이하의 정수.
- **설명 (Bio):** 최대 200자 제한.

---

```filepath:src/__tests__/fixtures/test-data.json
{
  "validUsers": [
    {
      "id": 1,
      "username": "tester01",
      "email": "test01@example.com",
      "age": 25,
      "bio": "안녕하세요, 테스트 유저입니다."
    },
    {
      "id": 2,
      "username": "김개발",
      "email": "dev.kim@company.co.kr",
      "age": 40,
      "bio": "Senior Fullstack Developer"
    }
  ],
  "invalidUsers": [
    {
      "id": 3,
      "username": "a",
      "reason": "Username too short",
      "email": "invalid-email",
      "age": -1,
      "bio": "Too long...".padEnd(205, '!')
    }
  ]
}
```

```filepath:src/__tests__/utils/validation-rules.ts
export const BUSINESS_RULES = {
  USERNAME: {
    MIN_LENGTH: 2,
    MAX_LENGTH: 20,
    PATTERN: /^[a-zA-Z0-9가-힣]+$/
  },
  EMAIL: {
    PATTERN: /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  },
  AGE: {
    MIN: 0,
    MAX: 120
  },
  BIO: {
    MAX_LENGTH: 200
  }
};
```

```filepath:src/__tests__/integration/TestDataValidation.test.ts
import testData from '../fixtures/test-data.json';
import { BUSINESS_RULES } from '../utils/validation-rules';

describe('테스트 데이터 비즈니스 정책 유효성 검증', () => {
  
  describe('정상 데이터(validUsers) 검증', () => {
    testData.validUsers.forEach((user) => {
      test(`사용자 ID ${user.id} (${user.username}) 데이터는 정책을 준수해야 함`, () => {
        // 1. Username 검증
        expect(user.username.length).toBeGreaterThanOrEqual(BUSINESS_RULES.USERNAME.MIN_LENGTH);
        expect(user.username.length).toBeLessThanOrEqual(BUSINESS_RULES.USERNAME.MAX_LENGTH);
        expect(user.username).toMatch(BUSINESS_RULES.USERNAME.PATTERN);

        // 2. Email 검증
        expect(user.email).toMatch(BUSINESS_RULES.EMAIL.PATTERN);

        // 3. Age 검증
        expect(user.age).toBeGreaterThanOrEqual(BUSINESS_RULES.AGE.MIN);
        expect(user.age).toBeLessThanOrEqual(BUSINESS_RULES.AGE.MAX);
        expect(Number.isInteger(user.age)).toBe(true);

        // 4. Bio 검증
        if (user.bio) {
          expect(user.bio.length).toBeLessThanOrEqual(BUSINESS_RULES.BIO.MAX_LENGTH);
        }
      });
    });
  });

  describe('경계값 및 엣지 케이스 검증', () => {
    test('데이터셋의 모든 항목은 중복된 ID를 가지지 않아야 함', () => {
      const allIds = [...testData.validUsers, ...testData.invalidUsers].map(u => u.id);
      const uniqueIds = new Set(allIds);
      expect(uniqueIds.size).toBe(allIds.length);
    });

    test('비정상 데이터(invalidUsers)는 실제 비즈니스 로직에서 거부되어야 함', () => {
      testData.invalidUsers.forEach(user => {
        const isUsernameValid = 
          user.username.length >= BUSINESS_RULES.USERNAME.MIN_LENGTH && 
          user.username.length <= BUSINESS_RULES.USERNAME.MAX_LENGTH;
        
        const isEmailValid = BUSINESS_RULES.EMAIL.PATTERN.test(user.email);
        
        // 하나 이상의 조건이 실패해야 함을 검증
        const isValid = isUsernameValid && isEmailValid;
        expect(isValid).toBe(false);
      });
    });
  });
});
```

---

### 작업 요약 보고 (PM 보고용)

#### 1. 생성 및 수정된 파일
- `src/__tests__/fixtures/test-data.json`: 실제 테스트에 사용될 구조화된 데이터 셋.
- `src/__tests__/utils/validation-rules.ts`: 비즈니스 정책 상수를 중앙 관리하여 테스트 신뢰도 향상.
- `src/__tests__/integration/TestDataValidation.test.ts`: 데이터의 유효성을 정밀하게 확인하는 통합 테스트 코드.

#### 2. 핵심 구현 결정 사항
- **Policy Centric:** 단순 값이 존재하는지 확인하는 수준을 넘어, 정규표현식과 경계값(Boundary Value) 범위를 적용했습니다.
- **Fail-fast:** 테스트 데이터 자체가 정책에 어긋날 경우 실제 기능 테스트 이전에 먼저 실패하도록 설계하여, 데이터 오염으로 인한 오탐(False Positive)을 방지했습니다.
- **Negative Testing:** `invalidUsers` 세트를 포함하여, 시스템이 부적절한 데이터를 어떻게 식별해야 하는지에 대한 기준을 마련했습니다.

#### 3. 테스팅 권장 사항
- CI/CD 파이프라인의 `pre-test` 단계에서 이 유효성 검사 테스트를 먼저 실행할 것을 권장합니다.
- 새로운 비즈니스 요구사항(예: 비밀번호 복잡도 추가 등)이 생길 경우 `validation-rules.ts`만 업데이트하여 전체 테스트에 반영할 수 있습니다.

#### 4. 차기 단계
- 현재의 JSON 데이터를 기반으로 API Mocking(MSW 등)을 수행하여 프론트엔드 통합 테스트와 연결할 예정입니다.
- 유효하지 않은 데이터 입력 시 적절한 에러 메시지가 사용자에게 노출되는지 확인하는 UI 테스트를 추가할 계획입니다.

---
*이 문서는 AI 에이전트에 의해 자동 생성되었습니다.*
